<%= form_with model: @poll, local: true, class: "space-y-6" do |form| %>
  <% if @poll.errors.any? %>
    <div class="bg-red-800 border border-red-700 text-white px-4 py-3 rounded-lg mb-4">
      <h2 class="font-bold">Erros ao salvar:</h2>
      <ul class="list-disc list-inside mt-2">
        <% @poll.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-4">
    <%= form.label :question, "Pergunta da Enquete", class: "block text-sm font-semibold text-gray-300 mb-2" %>
    <%= form.text_area :question, rows: 3, required: true, placeholder: "Ex: Qual sua cor favorita?",
          class: "w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" %>
  </div>

  <div class="mb-4">
    <%= form.label :poll_type, "Tipo", class: "block text-sm font-semibold text-gray-300 mb-2" %>
    <%= form.select :poll_type, options_for_select([['Escolha Única', 'single'], ['Múltipla Escolha', 'multiple']], @poll.poll_type),
          { required: true }, class: "w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" %>
  </div>

  <div data-controller="nested-form" class="mb-6">
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-semibold text-white">Opções de Voto</h3>
      <button type="button"
              data-action="nested-form#add"
              class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition transform hover:scale-105">
        + Adicionar opção
      </button>
    </div>

    <div data-nested-form-target="container" class="space-y-4">
      <%= form.fields_for :options do |opt_form| %>
        <div data-nested-form-wrapper class="flex gap-2 items-center">
          <%= opt_form.hidden_field :id %>
          <%= opt_form.text_field :content, placeholder: "Digite uma opção...",
                class: "flex-1 px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition", required: true %>

          <%= opt_form.hidden_field :_destroy, value: false %>

          <button type="button"
                  data-action="nested-form#remove"
                  class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition transform hover:scale-105">
            Remover
          </button>
        </div>

        <% if opt_form.object.errors[:content].any? %>
          <p class="text-sm text-red-400 mt-1"><%= opt_form.object.errors.full_messages_for(:content).join(', ') %></p>
        <% end %>
      <% end %>
    </div>

    <template data-nested-form-target="template">
      <div data-nested-form-wrapper class="flex gap-2 items-center">
        <input type="text"
               name="poll[options_attributes][NEW_RECORD][content]"
               placeholder="Digite uma opção..."
               class="flex-1 px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
               required />

        <input type="hidden"
               name="poll[options_attributes][NEW_RECORD][_destroy]"
               value="false" />

        <button type="button"
                data-action="nested-form#remove"
                class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition transform hover:scale-105">
          Remover
        </button>
      </div>
    </template>
  </div>

  <div class="flex gap-3 pt-6 border-t border-gray-800 mt-8">
    <%= form.submit @poll.new_record? ? "Criar Enquete" : "Atualizar Enquete",
          class: "w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform hover:scale-105 active:scale-95" %>

    <%= link_to 'Cancelar', polls_path, class: "w-full text-center bg-gray-700 text-gray-300 py-3 rounded-lg hover:bg-gray-600 transition" %>
  </div>
<% end %>